<?php
 goto iDIEA; uwDSS: include 'inc/api.php'; goto hn1ai; hn1ai: include 'lib/common.php'; goto AT8GE; iDIEA: defined('IN_IA') or exit('Access Denied'); goto uwDSS; AT8GE: class baiban_wxlinksModuleSite extends WeModuleSite { use api; public function __call($name, $arguments) { goto dd6y_; igbax: trigger_error('模块方法' . $name . '不存在.', E_USER_WARNING); goto VVA6l; rXIz9: $this->{$function_name}(); goto yR1Sk; gNt4B: xndk5: goto rXIz9; dd6y_: $function_name = 'do' . substr($name, 8); goto S8rcv; yR1Sk: UYyK_: goto Nkc7x; VVA6l: goto UYyK_; goto gNt4B; S8rcv: if (method_exists($this, $function_name)) { goto xndk5; } goto igbax; Nkc7x: } public function __construct() { goto jthKH; Bdra4: kKa7Z: goto GddzM; jthKH: if (!($_SERVER['SCRIPT_NAME'] == '/web/index.php')) { goto crmf9; } goto oZckL; tRes3: if (!($bindCount > 5)) { goto kKa7Z; } goto VxhqZ; oZckL: $bindCount = pdo_fetchcolumn('SELECT COUNT(id) FROM ' . tablename('uni_account_modules') . ' WHERE module = \'baiban_wxlinks\''); goto tRes3; qhs7f: exit; goto Bdra4; GddzM: crmf9: goto OhUrk; VxhqZ: echo '本模块在同一站点下最多允许绑定5个应用。'; goto qhs7f; OhUrk: } public function doMobileIndex() { goto p2R8J; tyw1T: mc_oauth_userinfo(); goto HN5Qj; HN5Qj: o6UQV: goto gApuf; p2R8J: global $_W; goto A4cTU; A4cTU: if ($_W['fans']['nickname']) { goto o6UQV; } goto tyw1T; gApuf: } public function doWebBanners() { goto QSdG1; ZaluB: if (!$result) { goto L64Jx; } goto Lt8TI; BWQJc: kLDLE: goto VTo0q; Lt8TI: foreach ($result as $key => $item) { $result[$key]['image'] = attachment_url($item['image']); BR13S: } goto BWQJc; LCABk: $result = pdo_getall('baiban_wxlinks_banners', $where, array(), '', array("weigh desc", "id desc")); goto ZaluB; VTo0q: L64Jx: goto N7YNd; N7YNd: include $this->template('banners'); goto AczyY; QSdG1: global $_W; goto wLJPg; wLJPg: $where = array("uniacid" => $_W['uniacid']); goto LCABk; AczyY: } public function doWebAddBanner() { goto JahRE; LpiDj: E7tmZ: goto QChz_; QChz_: pdo_update('baiban_wxlinks_banners', array("title" => $_GPC['title'], "image" => $_GPC['image'], "url" => $_GPC['url'], "weigh" => $_GPC['weigh'], "enable" => $_GPC['enable']), array("id" => $_GPC['id'], "uniacid" => $_W['uniacid'])); goto xrPSd; C9B_Q: goto SMic1; goto LpiDj; qa9xc: if ($_GPC['id']) { goto E7tmZ; } goto fdhaV; pJAef: message('设置成功！', $this->createWebUrl('banners'), 'success'); goto MPc1b; y21Y_: $banner = pdo_get('baiban_wxlinks_banners', array("id" => $id, "uniacid" => $_W['uniacid'])); goto I7QvF; W_wlX: if (!($id = intval($_GPC['id']))) { goto YNEyD; } goto y21Y_; FVTOa: include $this->template('addBanner'); goto IiUDT; Zwkdg: p9nqw: goto W_wlX; I7QvF: YNEyD: goto FVTOa; fdhaV: pdo_insert('baiban_wxlinks_banners', array("uniacid" => $_W['uniacid'], "title" => $_GPC['title'], "image" => $_GPC['image'], "url" => $_GPC['url'], "weigh" => $_GPC['weigh'], "enable" => $_GPC['enable'], "createtime" => time())); goto C9B_Q; xrPSd: SMic1: goto pJAef; MPc1b: exit; goto Zwkdg; ZPnnC: if (!checksubmit('submit')) { goto p9nqw; } goto qa9xc; JahRE: global $_W, $_GPC; goto ZPnnC; IiUDT: } public function doWebDelBanner() { goto TbiUC; TbiUC: global $_GPC, $_W; goto u50ct; a_bLY: pdo_delete('baiban_wxlinks_banners', array("id" => $id, "uniacid" => $_W['uniacid'])); goto a6fjj; a6fjj: message('删除成功', 'referer', 'success'); goto sQkus; u50ct: $id = $_GPC['id']; goto a_bLY; sQkus: } public function doWebUsers() { goto XbAXW; XbAXW: global $_W, $_GPC; goto G8h6T; GUDIX: include $this->template('users'); goto mhcb2; RD4S3: $where = array("uniacid" => $_W['uniacid']); goto hUA1i; kMZyE: oroCD: goto GUDIX; eyKEQ: if (!(count($result) == 20)) { goto oroCD; } goto ZG6zV; iKmTQ: $previous = $next = ''; goto XGAe1; G8h6T: $page = max(intval($_GPC['page']), 1); goto RD4S3; ZG6zV: $next = '?' . http_build_query(array_merge($_GET, array("page" => $page + 1))); goto kMZyE; XGAe1: if (!($page > 1)) { goto J3KzC; } goto CA5CM; T0EoW: empty($_GPC['s_openid']) || ($where['openid'] = $_GPC['s_openid']); goto sAH7w; I79vi: if (!$result) { goto XDBWi; } goto V1WS5; sAH7w: $result = pdo_getslice('baiban_wxlinks_users', $where, array($page, 20), $total, array(), '', array("id desc")); goto I79vi; nkjN_: wdp3V: goto w1ypA; CA5CM: $previous = '?' . http_build_query(array_merge($_GET, array("page" => $page - 1))); goto FtHIQ; w1ypA: XDBWi: goto iKmTQ; V1WS5: foreach ($result as $key => $item) { goto sA4uc; sA4uc: $result[$key]['nickname'] = $item['nickname'] ? $item['nickname'] : '-'; goto KbUgF; tNVeg: x5LMc: goto TmbBL; KbUgF: $result[$key]['vip'] = vip_status_str($item); goto tNVeg; TmbBL: } goto nkjN_; FtHIQ: J3KzC: goto eyKEQ; hUA1i: empty($_GPC['s_id']) || ($where['id'] = $_GPC['s_id']); goto T0EoW; mhcb2: } public function doWebLinks() { goto THrjX; qaiuU: G3dK5: goto joNr2; ocDDn: empty($_GPC['s_name']) || ($where['name like'] = "%{$_GPC['s_name']}%"); goto Wqgtw; rlkv2: if (!$result) { goto G3dK5; } goto cDRb8; rNlO_: empty($_GPC['s_type']) || ($where['type'] = $_GPC['s_type']); goto U_uTo; s3fjz: if (!(count($result) == 20)) { goto NCpH3; } goto jNDmk; vGjC9: tSPSN: goto s3fjz; sOlgo: $where = array("uniacid" => $_W['uniacid']); goto ocDDn; jNDmk: $next = '?' . http_build_query(array_merge($_GET, array("page" => $page + 1))); goto g0Iqu; o7ibV: include $this->template('links'); goto IK74C; Wqgtw: empty($_GPC['s_appid']) || ($where['appid'] = $_GPC['s_appid']); goto rNlO_; RjVbx: $previous = '?' . http_build_query(array_merge($_GET, array("page" => $page - 1))); goto vGjC9; THrjX: global $_W, $_GPC; goto VelHS; joNr2: $previous = $next = ''; goto MehZF; MehZF: if (!($page > 1)) { goto tSPSN; } goto RjVbx; U_uTo: $result = pdo_getslice('baiban_wxlinks_links', $where, array($page, 20), $total, array(), '', array("id desc")); goto rlkv2; cDRb8: foreach ($result as $key => $item) { goto y2BJO; fHSYM: $result[$key]['qrcode'] = murl('entry/wxapp/qrcode', ["m" => "baiban_wxlinks", "id" => $item['id']], true, true); goto EP9fk; EP9fk: iQt5E: goto jM_cf; y2BJO: $result[$key]['link'] = calc_link($item, $this->module['config']); goto fHSYM; jM_cf: } goto Ynf68; g0Iqu: NCpH3: goto o7ibV; VelHS: $page = max(intval($_GPC['page']), 1); goto sOlgo; Ynf68: Uqe0i: goto qaiuU; IK74C: } public function doWebDel() { goto PUU97; Of5gF: oHB5T: goto StZ9z; PuSpH: xOWtE: goto aLQLN; PUU97: global $_GPC, $_W; goto vlW0X; RD_4i: pdo_update('baiban_wxlinks_wxapps', array("links -=" => 1, "views -=" => $link['views']), array("id" => $link['wxappid'])); goto sK3Lx; sK3Lx: Oq7pZ: goto BBdHF; lvMxi: if (!$link['wxappid']) { goto Oq7pZ; } goto RD_4i; vlW0X: $id = $_GPC['id']; goto xvQZM; Ke9Mz: exit; goto Of5gF; xvQZM: if ($link = pdo_get('baiban_wxlinks_links', array("id" => $id, "uniacid" => $_W['uniacid']))) { goto oHB5T; } goto v7T2o; v7T2o: message('删除成功', 'referer', 'success'); goto Ke9Mz; BBdHF: if (!file_exists(ATTACHMENT_ROOT . $link['return'])) { goto xOWtE; } goto NTzEJ; fxllM: pdo_delete('baiban_wxlinks_visit', array("linkid" => $id)); goto lvMxi; NTzEJ: @unlink(ATTACHMENT_ROOT . $link['return']); goto PuSpH; aLQLN: message('删除成功', 'referer', 'success'); goto W0qU_; StZ9z: pdo_delete('baiban_wxlinks_links', array("id" => $id)); goto VIxxU; VIxxU: pdo_update('baiban_wxlinks_users', array("links -=" => 1), array("id" => $link['userid'])); goto fxllM; W0qU_: } public function doWebShort() { goto RgGDi; RgGDi: global $_W; goto zl4yF; UD9Ke: include $this->template('short'); goto HnYRo; zl4yF: $config = $this->module['config']; goto UD9Ke; HnYRo: } public function doWebDomains() { goto Sylkm; wxO05: $this->saveSettings($config); goto c3alO; ZuxX3: if (!(strpos($config['domain'], 'http') !== 0)) { goto hUZIw; } goto PpHOU; d2lqb: include $this->template('domains'); goto ECtlw; S6qwG: $config = $this->module['config']; goto rilLY; H6Dsg: $config['domain'] = strtolower(trim($_GPC['domain'])); goto GCJAo; rilLY: if (!checksubmit('submit')) { goto pxpVf; } goto H6Dsg; PpHOU: message('默认链接域名请以http或https开头！', 'referer', 'error'); goto VXxUJ; i9Qz9: message('正式会员链接域名请以http或https开头！', 'referer', 'error'); goto K19CY; Sylkm: global $_W, $_GPC; goto S6qwG; c3alO: message('设置成功！', 'referer', 'success'); goto aAPxu; VXxUJ: hUZIw: goto AkjGP; GCJAo: $config['vipdomain'] = strtolower(trim($_GPC['vipdomain'])); goto ZuxX3; AkjGP: if (!($config['vipdomain'] && strpos($config['vipdomain'], 'http') !== 0)) { goto dIguW; } goto i9Qz9; K19CY: dIguW: goto wxO05; aAPxu: pxpVf: goto d2lqb; ECtlw: } public function doWebShorton() { goto UEU6S; j1FjL: K4rtX: goto E1WfN; EfgsT: $res = mkdir(iconv('UTF-8', 'GBK', $path), 0777, true); goto JS8xQ; E1WfN: $res = copy(MODULE_ROOT . '/s.php', $path . '/index.php'); goto fz4iN; rF7D5: aXfa2: goto ExtLi; UEU6S: global $_GPC, $_W; goto BcemK; Frd9h: $this->saveSettings($config); goto ftrmj; ftrmj: message('超短链接功能开启成功', 'referer', 'success'); goto ShXzY; PLI3M: message("文件 {$path}/index.php 创建失败，请检查权限", 'referer', 'error'); goto vK8_Q; WwkVt: message('目录下存在同名文件“s”，开启失败', 'referer', 'error'); goto gfsnw; BcemK: $path = IA_ROOT . '/s'; goto o5T_C; JJ7Yv: message("目录 {$path} 创建失败，请检查权限", 'referer', 'error'); goto rF7D5; ShXzY: sIQYU: goto hB6S4; o5T_C: if (file_exists($path)) { goto VeebU; } goto EfgsT; JkAb9: mIxk2: goto uKcRl; gfsnw: tUOoR: goto j1FjL; ExtLi: goto K4rtX; goto nD64v; fz4iN: if ($res) { goto mIxk2; } goto PLI3M; uKcRl: $config = $this->module['config']; goto rHKMi; nD64v: VeebU: goto w6ba1; vK8_Q: goto sIQYU; goto JkAb9; rHKMi: $config['short'] = true; goto Frd9h; w6ba1: if (!is_file($path)) { goto tUOoR; } goto WwkVt; JS8xQ: if ($res) { goto aXfa2; } goto JJ7Yv; hB6S4: } public function doWebShortoff() { goto dUIdR; dUIdR: global $_GPC, $_W; goto tFIQ0; tFIQ0: $path = IA_ROOT . '/s'; goto GB8nk; E1fqL: message('超短链接功能关闭成功', 'referer', 'success'); goto i0IxR; V83K_: eZeup: goto l9gMt; tEp28: $config['short'] = false; goto Lu7R6; GB8nk: if (!file_exists($path)) { goto OroPH; } goto if58e; l9gMt: OroPH: goto Z7jw7; v2C2c: @rmdir($path); goto V83K_; LStuv: @unlink($path . '/index.php'); goto v2C2c; if58e: if (!is_dir($path)) { goto eZeup; } goto LStuv; Z7jw7: $config = $this->module['config']; goto tEp28; Lu7R6: $this->saveSettings($config); goto E1fqL; i0IxR: } public function doWebCompat() { goto BkjR8; SHc2Y: if ($uself) { goto mF0CF; } goto DfnDo; AF0Am: $uself = false; goto BeAe8; ZEog9: $mps = pdo_getall('account_wechats', array("level" => 4), array("uniacid", "account", "name")); goto fZUqi; YnkUX: sQHtp: goto IEESk; h5ZGR: GWdu5: goto beYXV; F_Osb: $config['compat_account'] = $_W['uniacid']; goto CBoxD; SohIy: $this->saveSettings($config); goto PIv7Z; kDxAE: exit; goto NEekJ; dKBSE: $config = $this->module['config']; goto OySAW; bJKn_: $config['jssafe_domain'] = $_GPC['jssafe_domain']; goto SohIy; cRd3w: include $this->template('compat'); goto Xonxj; beYXV: $uself = true; goto YnkUX; NEekJ: XzBol: goto O33e3; BkjR8: global $_GPC, $_W; goto dKBSE; CBoxD: ORFsI: goto bJKn_; PIv7Z: message('设置成功！', 'referer', 'success'); goto kDxAE; BeAe8: goto sQHtp; goto h5ZGR; O33e3: if ($uself) { goto UFocl; } goto ZEog9; dPeqe: mF0CF: goto F_Osb; fZUqi: UFocl: goto cRd3w; DfnDo: $config['compat_account'] = $_GPC['compat_account']; goto NVBT5; NVBT5: goto ORFsI; goto dPeqe; OySAW: if ($_W['uniaccount']->type == '1' && $_W['uniaccount']->account['level'] == '4') { goto GWdu5; } goto AF0Am; IEESk: if (!checksubmit('submit')) { goto XzBol; } goto SHc2Y; Xonxj: } public function doWebUnilinks() { goto ufHce; yxM2a: if (!checksubmit('submit')) { goto M_HOg; } goto V5QxF; K3p85: $buy_uniwxh = buyCheck('uniwxh') ? '<span class="text-success">已购买开通</span>' : '<a target="_blank" href="https://s.w7.cc/module-28983.html" class="btn btn-primary">安装免费插件后可用</a>'; goto X1ZTR; X1ZTR: $buy_unigzh = buyCheck('unigzh') ? '<span class="text-success">已购买开通</span>' : '<a target="_blank" href="https://s.w7.cc/module-28984.html" class="btn btn-primary">安装免费插件后可用</a>'; goto XP1pe; ycoX0: message('设置成功！', 'referer', 'success'); goto jGqPx; PA8_v: $config = $this->module['config']; goto yxM2a; jGqPx: exit; goto ykL7r; WXc4p: include $this->template('unilinks'); goto LwAFq; TuKVV: $buy_uniwxq = buyCheck('uniwxq') ? '<span class="text-success">已购买开通</span>' : '<a target="_blank" href="https://s.w7.cc/module-28982.html" class="btn btn-primary">安装免费插件后可用</a>'; goto tvV7I; cJNIn: $buy_uniqywx = buyCheck('uniqywx') ? '<span class="text-success">已购买开通</span>' : '<a target="_blank" href="https://s.w7.cc/module-28986.html" class="btn btn-primary">安装免费插件后可用</a>'; goto WXc4p; ufHce: global $_GPC, $_W; goto PA8_v; V5QxF: $config['orid'] = $_GPC['orid']; goto vG2Bh; XClc3: $buy_grxcx = buyCheck('grxcx') ? '<span class="text-success">已购买开通</span>' : '<a target="_blank" href="https://s.w7.cc/module-29259.html" class="btn btn-primary">安装免费插件后可用</a>'; goto K3p85; XP1pe: $buy_unigzhwz = buyCheck('unigzhwz') ? '<span class="text-success">已购买开通</span>' : '<a target="_blank" href="https://s.w7.cc/module-29219.html" class="btn btn-primary">安装免费插件后可用</a>'; goto TuKVV; tvV7I: $buy_unisph = buyCheck('unisph') ? '<span class="text-success">已购买开通</span>' : '<a target="_blank" href="https://s.w7.cc/module-28985.html" class="btn btn-primary">安装免费插件后可用</a>'; goto cJNIn; Jov6f: $this->saveSettings($config); goto ycoX0; ykL7r: M_HOg: goto XClc3; vG2Bh: $config['adv']['messageimg'] = $_GPC['advmessageimg']; goto Jov6f; LwAFq: } public function doWebSensitive() { goto MU8EQ; mmG8k: ECmXJ: goto UVpPT; UVpPT: include $this->template('sensitive'); goto lzOgN; aNbLj: if (!checksubmit('submit')) { goto ECmXJ; } goto JlxWU; hhHv7: exit; goto mmG8k; n0C64: if (buyCheck('sensitive')) { goto c3DN4; } goto ITSoa; NIobW: c3DN4: goto e0hU5; f5IPJ: exit; goto NIobW; GWE4B: $config['sensitive']['img'] = $_GPC['sensitiveimg']; goto adwfc; eajZR: message('设置成功！', 'referer', 'success'); goto hhHv7; JlxWU: $config['sensitive']['text'] = $_GPC['sensitivetext']; goto GWE4B; OGL3_: include $this->template('needbuy'); goto f5IPJ; adwfc: $this->saveSettings($config); goto eajZR; ITSoa: $content = '您尚未购买敏感内容过滤插件，请前往商城<a href="https://s.w7.cc/module-29236.html" class="btn btn-success">购买敏感内容过滤插件</a>'; goto OGL3_; e0hU5: $config = $this->module['config']; goto aNbLj; MU8EQ: global $_W, $_GPC; goto n0C64; lzOgN: } public function doWebPremiums() { goto rA23f; epseQ: $config['premiums']['freeexpire'] = $_GPC['freeexpire']; goto QTAyx; oJRIe: $config['premiums']['freedays'] = $_GPC['freedays']; goto epseQ; XIXgf: exit; goto k2zsq; J2JpA: $buy_copywords = false; goto eL8oa; wHhcT: $config['premiums']['vipcopywords'] = $_GPC['vipcopywords']; goto Tj7bE; rA23f: global $_GPC, $_W; goto J2JpA; LYUYU: $buy_copywords = true; goto ITSuy; ITSuy: TwNsD: goto Q1ku2; ir0jF: if (!checksubmit('submit')) { goto qmWZj; } goto oJRIe; vh63Q: message('设置成功！', 'referer', 'success'); goto XIXgf; kh5O7: $config['premiums']['vipright'] = $_GPC['vipright']; goto JBqYJ; Tj7bE: eFKFZ: goto sFiaJ; JBqYJ: if ($buy_copywords) { goto RX8Kt; } goto f6Xmr; WP1oa: $config['premiums']['freeright'] = $_GPC['freeright']; goto x2FJF; x2FJF: $config['premiums']['viplimit'] = $_GPC['viplimit']; goto kh5O7; Q1ku2: $config = $this->module['config']; goto ir0jF; y0neQ: include $this->template('premiums'); goto JN2OK; QTAyx: $config['premiums']['freelimit'] = $_GPC['freelimit']; goto WP1oa; eL8oa: if (!buyCheck('copywords')) { goto TwNsD; } goto LYUYU; f6Xmr: $config['premiums']['vipcopywords'] = ''; goto HOTnb; PJkSv: RX8Kt: goto wHhcT; sFiaJ: $this->saveSettings($config); goto vh63Q; k2zsq: qmWZj: goto y0neQ; HOTnb: goto eFKFZ; goto PJkSv; JN2OK: } public function doWebSetvip() { goto XFzSR; S8pbY: pdo_update('baiban_wxlinks_users', array("expiretime" => $expiretime), array("id" => $_GPC['id'], "uniacid" => $_W['uniacid'])); goto nykSA; Q1AOU: pdo_update('baiban_wxlinks_users', array("expiretime" => $expiretime), array("id" => $_GPC['id'], "uniacid" => $_W['uniacid'])); goto WZ12k; JZDcP: pL7Ea: goto hX6qR; ztxuV: if ($_GPC['stopvip']) { goto Iv4Gz; } goto CyaQK; CQWHn: $expiretime = time(); goto Q1AOU; Q2R_1: xzVF_: goto oQ382; XFzSR: global $_W, $_GPC; goto HChSW; xF1wK: if (!$_GPC['id']) { goto xzVF_; } goto ztxuV; SOuqs: if (!($days < 1 || $days > 366)) { goto xNNaB; } goto kZt3k; P6w0m: NNE4p: goto S8pbY; xJFdM: Iv4Gz: goto CQWHn; WZ12k: pdo_query('UPDATE ' . tablename('baiban_wxlinks_links') . ' SET expiretime = createtime + :freeexpire WHERE uniacid = :uniacid AND userid = :userid', array(":userid" => $_GPC['id'], ":uniacid" => $_W['uniacid'], ":freeexpire" => $this->module['config']['premiums']['freeexpire'] * 86400)); goto Eu8RW; mCHk_: if (!checksubmit('submit')) { goto pL7Ea; } goto xF1wK; CyaQK: $days = intval($_GPC['days']); goto SOuqs; eS13U: tZAjB: goto mCHk_; sV7lU: goto MygS_; goto xJFdM; lbY0k: exit; goto JZDcP; OUZVj: xNNaB: goto UzBIm; KYcRL: $expiretime = $user['expiretime'] + $days * 86400; goto P6w0m; nykSA: pdo_update('baiban_wxlinks_links', array("expiretime" => $expiretime), array("userid" => $_GPC['id'], "uniacid" => $_W['uniacid'])); goto sV7lU; kZt3k: message('充值正式会员天数有效区间1~366', 'referer', 'error'); goto OUZVj; MXmx2: $user = pdo_get('baiban_wxlinks_users', array("id" => $id, "uniacid" => $_W['uniacid'])); goto eS13U; UzBIm: if ($user['expiretime'] > time()) { goto UAS6I; } goto UI7wq; Eu8RW: MygS_: goto Q2R_1; oQ382: message('会员设置成功！', 'referer', 'success'); goto lbY0k; J0K77: UAS6I: goto KYcRL; AW_li: goto NNE4p; goto J0K77; HChSW: if (!($id = intval($_GPC['id']))) { goto tZAjB; } goto MXmx2; hX6qR: include $this->template('setvip'); goto oFlqP; UI7wq: $expiretime = time() + $days * 86400; goto AW_li; oFlqP: } public function doWebPersonal() { goto SFA70; t1Bb3: BFvhe: goto qZhvf; vIPdz: $data = json_encode($data, 256); goto DS0mb; SFA70: global $_W, $_GPC; goto Bz5tN; Ypn8n: $personal = json_decode($user['config'], true); goto z7tDx; z7tDx: if (!empty($personal)) { goto FTX5h; } goto g9I1s; RwuM3: $data = array_merge($personal, $_POST); goto fMqLN; Bz5tN: if (!($id = intval($_GPC['id']))) { goto TLrAp; } goto KWNDL; DS0mb: pdo_update('baiban_wxlinks_users', array("config" => $data), array("id" => $_GPC['id'], "uniacid" => $_W['uniacid'])); goto t1Bb3; fo8mU: exit; goto g3AeT; oKSe1: tvFbW: goto Ypn8n; g9I1s: $personal = array(); goto sgKRW; g3AeT: Y321N: goto NlJY_; NqME3: TLrAp: goto IuATN; qoNKx: if (!checksubmit('submit')) { goto Y321N; } goto tZfaw; fMqLN: unset($data['token']); goto nMc8G; KWNDL: $user = pdo_get('baiban_wxlinks_users', array("id" => $id, "uniacid" => $_W['uniacid'])); goto NqME3; sgKRW: FTX5h: goto qoNKx; nMc8G: unset($data['submit']); goto vIPdz; YU1Hs: message('用户不存在', 'referer', 'error'); goto oKSe1; NlJY_: include $this->template('personal'); goto th7Te; tZfaw: if (!$_GPC['id']) { goto BFvhe; } goto RwuM3; qZhvf: message('设置成功！', 'referer', 'success'); goto fo8mU; IuATN: if ($user) { goto tvFbW; } goto YU1Hs; th7Te: } public function doWebCdkeys() { goto ACGyP; FwyFJ: $page = max(intval($_GPC['page']), 1); goto dRIYa; dRIYa: $where = array("uniacid" => $_W['uniacid']); goto dMYgS; BFxuA: EaVD2: goto zDfZ4; JK6Ak: $next = '?' . http_build_query(array_merge($_GET, array("page" => $page + 1))); goto mfmZ4; EkMsz: if (!($page > 1)) { goto ugkm_; } goto BRj_N; yzV7p: $where['usetime <>'] = 0; goto PzGjM; gzCFj: include $this->template('cdkeys'); goto b8ADm; VA1sy: T_Bbw: goto rxXXz; z_JZn: ugkm_: goto m1iRd; LgwKz: $result = pdo_getslice('baiban_wxlinks_cdkeys', $where, array($page, 20), $total, array(), '', array("id desc")); goto Yc9O1; aBOf8: empty($_GPC['s_cdkey']) || ($where['cdkey'] = $_GPC['s_cdkey']); goto mYRdo; BRj_N: $previous = '?' . http_build_query(array_merge($_GET, array("page" => $page - 1))); goto z_JZn; PzGjM: goto rXnb3; goto VA1sy; zDfZ4: $previous = $next = ''; goto EkMsz; GQovc: empty($_GPC['s_userid']) || ($where['userid'] = $_GPC['s_userid']); goto LgwKz; rxXXz: $where['usetime'] = 0; goto wSm7j; m1iRd: if (!(count($result) == 20)) { goto zjY9U; } goto JK6Ak; dMYgS: if ($_GPC['s_used'] == 1) { goto hPFAg; } goto O_Dv5; mYRdo: empty($_GPC['s_days']) || ($where['days'] = $_GPC['s_days']); goto GQovc; O_Dv5: if ($_GPC['s_used'] == 2) { goto T_Bbw; } goto i5xSX; Yc9O1: if (!$result) { goto EaVD2; } goto kVaGV; AqNs7: hPFAg: goto yzV7p; wSm7j: rXnb3: goto LyZdp; LyZdp: empty($_GPC['s_id']) || ($where['id'] = $_GPC['s_id']); goto aBOf8; dToEQ: xHDwB: goto BFxuA; i5xSX: goto rXnb3; goto AqNs7; ACGyP: global $_W, $_GPC; goto FwyFJ; kVaGV: foreach ($result as $key => $item) { goto KfFFW; KfFFW: if ($item['usetime']) { goto uPWNE; } goto Jy2oo; SP3oe: $result[$key]['userid'] = '尚未使用'; goto Mqs1D; PQxap: uPWNE: goto WTz0q; DDZmq: BQZ_R: goto g9cgI; WTz0q: $result[$key]['usetime'] = date('Y-m-d H:i:s', $item['usetime']); goto DDZmq; HYKtP: A22Fo: goto SCswE; Jy2oo: $result[$key]['usetime'] = '尚未使用'; goto SP3oe; g9cgI: $result[$key]['createtime'] = date('Y-m-d H:i:s', $item['createtime']); goto HYKtP; Mqs1D: goto BQZ_R; goto PQxap; SCswE: } goto dToEQ; mfmZ4: zjY9U: goto gzCFj; b8ADm: } public function doWebExportCdkeys() { goto s3Pj9; hYr04: BUgQ6: goto UpLx2; R1BWQ: $where['usetime'] = 0; goto koxL8; Juuqr: if ($result) { goto BUgQ6; } goto lUPzp; FrPhA: $where = array("uniacid" => $_W['uniacid']); goto R1BWQ; lUPzp: message('没有尚未使用的卡密，无法导出', 'referer', 'warning'); goto hYr04; UpLx2: export_csv($result, '卡密ID, 卡密号, 兑换日期', '尚未使用的卡密' . date('YmdHis')); goto Q3sWB; s3Pj9: global $_W, $_GPC; goto FrPhA; koxL8: $result = pdo_getall('baiban_wxlinks_cdkeys', $where, array("id", "cdkey", "days")); goto Juuqr; Q3sWB: } public function doWebAddCdkey() { goto bWjqy; zPU5h: if (!checksubmit('submit')) { goto fwhrM; } goto iJsYn; ocUoJ: goto X4gRJ; goto Gadjj; xpkAm: fwhrM: goto bT9ST; gz563: if (!($amount < 1 || $amount > 50)) { goto VqcET; } goto yRt4W; Suz_m: $i++; goto ocUoJ; VkUMv: X4gRJ: goto IRIQ2; c75j7: $cdkey = uniqid() . rand_str(7); goto fkm3P; vUTGb: message('创建成功！', $this->createWebUrl('cdkeys'), 'success'); goto xpkAm; w1ZMM: pdo_run($sql); goto vUTGb; Gadjj: mZwUj: goto w1ZMM; M_aNR: wqUkC: goto Suz_m; IRIQ2: if (!($i < $amount)) { goto mZwUj; } goto c75j7; yRt4W: message('创建数量有效区间1~50', 'referer', 'error'); goto ZaluZ; iJsYn: $amount = intval($_GPC['amount']); goto Sl5DY; Sl5DY: $days = intval($_GPC['days']); goto PZ2_i; fkm3P: $sql .= 'INSERT INTO ' . tablename('baiban_wxlinks_cdkeys') . " (`uniacid`, `cdkey`, `days`, `createtime`) VALUES ('{$_W['uniacid']}', '{$cdkey}', '{$days}', '{$now}');"; goto M_aNR; PZ2_i: if (!($days < 1 || $days > 366)) { goto X7K_P; } goto x68EJ; bWjqy: global $_W, $_GPC; goto zPU5h; pUm1Q: $sql = ''; goto rh2KS; x68EJ: message('会员天数有效区间1~366', 'referer', 'error'); goto kBwhe; kBwhe: X7K_P: goto gz563; bT9ST: include $this->template('addCdkey'); goto R0mcM; ZaluZ: VqcET: goto kInZc; rh2KS: $i = 0; goto VkUMv; kInZc: $now = time(); goto pUm1Q; R0mcM: } public function doWebDelCdkey() { goto jLIzz; jLIzz: global $_GPC, $_W; goto T0NdX; T0NdX: $id = $_GPC['id']; goto Al_A3; Y0qLI: message('删除成功', 'referer', 'success'); goto Eqdwt; Al_A3: pdo_delete('baiban_wxlinks_cdkeys', array("id" => $id, "uniacid" => $_W['uniacid'])); goto Y0qLI; Eqdwt: } public function doWebAdv() { goto RxOgl; uVl0i: $config['adv']['vipappdiy'] = $_GPC['advvipappdiy']; goto Rfsf_; jl5Dg: pmHCR: goto hNJeI; onlrV: $config['adv']['pageurl'] = $_GPC['advpageurl']; goto lvQ3B; h5Wio: $advpage = $config['adv']['page']; goto wh1xG; sNrsk: if (empty($config['adv']['pageurl'])) { goto pmHCR; } goto piuJA; S0ceq: message('设置成功！', 'referer', 'success'); goto C4k7f; n4xZE: if (empty($config['adv']['page'])) { goto KN3Zn; } goto h5Wio; OaskK: $config['adv']['apptext'] = $_GPC['advapptext']; goto ePlp3; Rfsf_: $this->saveSettings($config); goto S0ceq; wh1xG: KN3Zn: goto sNrsk; ePlp3: $config['adv']['apptop'] = $_GPC['advapptop']; goto uVl0i; A6n83: M0DoO: goto n4xZE; lvQ3B: $config['adv']['pagevip'] = $_GPC['advpagevip']; goto OaskK; RxOgl: global $_GPC, $_W; goto v1fmS; cJhhT: if (!checksubmit('submit')) { goto M0DoO; } goto C9FRR; hNJeI: include $this->template('adv'); goto PiwTl; v1fmS: $config = $this->module['config']; goto cJhhT; piuJA: $advpageurl = $config['adv']['pageurl']; goto jl5Dg; C9FRR: $config['adv']['page'] = $_GPC['advpage']; goto onlrV; C4k7f: exit; goto A6n83; PiwTl: } public function doWebOnekey() { goto IlTn5; kOBxm: $status = '<span class="text-success">服务正常使用</span>'; goto QcSPe; bcQ5K: pdo_insert('baiban_wxlinks_platform', $data); goto fJVYR; x3b9J: $status = '<span class="text-warning">等待微信推送认证，10分钟后再看</span>'; goto od22K; vaPUh: exit; goto W0zya; ytcbt: $data['component_key'] = $_GPC['component_key']; goto ICRdv; Yjh1u: pSOUG: goto kOBxm; egL5Q: message('设置成功！', 'referer', 'success'); goto Yjh1u; fJVYR: goto WMFLY; goto GuYGg; dQUN6: if (!checksubmit('submit')) { goto pSOUG; } goto IuSZY; gjYL2: if ($platform) { goto y3JJy; } goto ZZuW1; IlTn5: global $_W, $_GPC; goto PrYPG; od22K: FMJOc: goto uFBGE; ICRdv: $data['component_verify_ticket'] = $data['component_access_token'] = ''; goto zKkSS; E28_9: $data['component_token'] = $_GPC['component_token']; goto ytcbt; QcSPe: if ($platform['component_verify_ticket']) { goto FMJOc; } goto x3b9J; W0zya: YprLV: goto I9vWX; zKkSS: $data['component_expire_time'] = 0; goto gjYL2; I9vWX: $platform = pdo_get('baiban_wxlinks_platform', array("uniacid" => $_W['uniacid'])); goto dQUN6; ZZuW1: $data['uniacid'] = $_W['uniacid']; goto bcQ5K; GuYGg: y3JJy: goto velqQ; uVUGB: include $this->template('needbuy'); goto vaPUh; uFBGE: include $this->template('onekey'); goto GS3rX; velqQ: pdo_update('baiban_wxlinks_platform', $data, array("uniacid" => $_W['uniacid'])); goto jGugJ; jGugJ: WMFLY: goto egL5Q; PrYPG: if (buyCheck('onekey')) { goto YprLV; } goto DdNpj; IuSZY: $data['component_appid'] = $_GPC['component_appid']; goto H1X85; DdNpj: $content = '您尚未购买一键授权插件，请前往商城<a href="https://s.w7.cc/module-28908.html" class="btn btn-success">购买一键授权插件</a>'; goto uVUGB; H1X85: $data['component_appsecret'] = $_GPC['component_appsecret']; goto E28_9; GS3rX: } public function doWebPromotion() { goto H0n2O; xyZjJ: E2W87: goto AG4wt; AG4wt: $this->saveSettings($config); goto I3s7Z; d33aK: rNN2u: goto TU86Z; FuCn_: goto E2W87; goto d33aK; fthei: $config = $this->module['config']; goto Ie2kh; Ie2kh: $buy_promotion = buyCheck('promotion'); goto SxEnq; olQqC: if ($buy_promotion) { goto rNN2u; } goto KXaCo; KXaCo: unset($config['promotion']); goto FuCn_; f9mG5: wkNlk: goto EN2FU; TU86Z: $config['promotion'] = array("vipshow" => $_GPC['vipshow'], "vipvideo" => $_GPC['vipvideo'], "index" => $_GPC['index'], "list" => $_GPC['list'], "linkdetail" => $_GPC['linkdetail'], "jump" => $_GPC['jump'], "create" => $_GPC['create']); goto xyZjJ; I3s7Z: message('流量主设置成功', 'referer', 'success'); goto f9mG5; SxEnq: if (!checksubmit('submit')) { goto wkNlk; } goto olQqC; EN2FU: include $this->template('promotion'); goto rNCw0; H0n2O: global $_GPC, $_W; goto fthei; rNCw0: } } ?>